# ERC-8004 + x402 é›†æˆæŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å°† **ERC-8004**ï¼ˆAI Agent èº«ä»½å’Œå£°èª‰ç®¡ç†æ ‡å‡†ï¼‰ä¸ **x402**ï¼ˆæ”¯ä»˜åè®®ï¼‰å®Œç¾ç»“åˆï¼Œæ‰“é€ ä¸€ä¸ªå¯å˜ç°çš„ AI Agent å‘ç°å’Œäº¤äº’å¹³å°ã€‚

### æ ¸å¿ƒä»·å€¼

1. **å»ä¸­å¿ƒåŒ–èº«ä»½** - AI Agents åœ¨é“¾ä¸Šæ‹¥æœ‰å¯éªŒè¯çš„èº«ä»½
2. **å£°èª‰ç³»ç»Ÿ** - åŸºäºçœŸå®äº¤äº’çš„é“¾ä¸Šè¯„åˆ†æœºåˆ¶
3. **æ”¯ä»˜å¢™** - é«˜çº§åŠŸèƒ½ä½¿ç”¨ x402 åè®®æ”¶è´¹
4. **å¯å‘ç°æ€§** - é€šè¿‡ The Graph ç´¢å¼•ï¼Œè½»æ¾æœç´¢å’Œå‘ç° Agents

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```bash
# ERC-8004 é…ç½®
X402_WALLET_PRIVATE_KEY=your_private_key_here
ERC8004_NETWORK=sepolia  # æˆ– mainnet, base
X402_RPC_URL=https://sepolia.infura.io/v3/YOUR_KEY

# x402 é…ç½®ï¼ˆå·²æœ‰ï¼‰
X402_BASE_ADDRESS=0xYourAddress
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œæ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–ï¼š

```bash
psql -U your_user -d your_database -f src/erc8004/database-schema.sql
```

### 4. å¯åŠ¨æœåŠ¡

```bash
npm run build
npm start
```

## åŠŸèƒ½ç‰¹æ€§

### MCP å·¥å…·

#### 1. æ³¨å†Œ AI Agent

```javascript
// é€šè¿‡ Claude Desktop è°ƒç”¨
{
  "tool": "erc8004_register_agent",
  "arguments": {
    "name": "DeFi Trading Bot",
    "description": "è‡ªåŠ¨åŒ– DeFi äº¤æ˜“å’Œå¥—åˆ©æœºå™¨äºº",
    "capabilities": ["trading", "arbitrage", "market-analysis"],
    "apiEndpoint": "https://api.example.com/trading-bot",
    "tags": ["defi", "trading", "automation"]
  }
}
```

**è¿”å›ç»“æœï¼š**
```
âœ… Agent æ³¨å†ŒæˆåŠŸï¼

Agent ID: 42
äº¤æ˜“å“ˆå¸Œ: 0x1234...
```

#### 2. æœç´¢ Agents

```javascript
{
  "tool": "erc8004_search_agents",
  "arguments": {
    "keyword": "trading",
    "tags": ["defi"],
    "minRating": 4.0,
    "limit": 20
  }
}
```

#### 3. è·å– Agent è¯¦æƒ…

```javascript
{
  "tool": "erc8004_get_agent",
  "arguments": {
    "agentId": "42"
  }
}
```

#### 4. æäº¤åé¦ˆ

```javascript
{
  "tool": "erc8004_submit_feedback",
  "arguments": {
    "agentId": "42",
    "rating": 5,
    "comment": "ä¼˜ç§€çš„äº¤æ˜“æœºå™¨äººï¼Œæ”¶ç›Šç¨³å®šï¼"
  }
}
```

#### 5. è·å–çƒ­é—¨ Agents

```javascript
{
  "tool": "erc8004_get_trending",
  "arguments": {
    "limit": 10
  }
}
```

#### 6. å¹³å°ç»Ÿè®¡

```javascript
{
  "tool": "erc8004_get_stats",
  "arguments": {}
}
```

### HTTP API ç«¯ç‚¹

#### åŸºç¡€ç«¯ç‚¹ï¼ˆå…è´¹ï¼‰

**æœç´¢ Agents**
```bash
GET /api/erc8004?action=search&keyword=trading&first=20
```

**è·å–çƒ­é—¨ Agents**
```bash
GET /api/erc8004?action=trending&limit=10
```

**è·å– Agent è¯¦æƒ…**
```bash
GET /api/erc8004?action=agent&id=42
```

**å¹³å°ç»Ÿè®¡**
```bash
GET /api/erc8004?action=stats
```

#### é«˜çº§ç«¯ç‚¹ï¼ˆéœ€è¦ x402 æ”¯ä»˜ï¼‰

**è·å–å¤§é‡åé¦ˆï¼ˆè¶…è¿‡ 10 æ¡éœ€è¦æ”¯ä»˜ï¼‰**
```bash
GET /api/erc8004?action=feedbacks&agentId=42&first=100
# éœ€è¦åœ¨ Header ä¸­åŒ…å« X-Payment: <payment_signature>
```

æ”¯ä»˜è¦æ±‚ç¤ºä¾‹ï¼š
```json
{
  "error": "Payment Required",
  "paymentRequired": {
    "amount": "0.0001",
    "currency": "ETH",
    "network": "base",
    "description": "è·å– 100 æ¡åé¦ˆè®°å½•"
  }
}
```

#### å†™å…¥ç«¯ç‚¹ï¼ˆéœ€è¦é“¾ä¸Šäº¤æ˜“ï¼‰

**æ³¨å†Œæ–° Agent**
```bash
POST /api/erc8004?action=register
Content-Type: application/json

{
  "name": "My Trading Bot",
  "metadata": {
    "description": "...",
    "capabilities": ["trading", "analytics"],
    "tags": ["defi"]
  }
}
```

**æäº¤åé¦ˆ**
```bash
POST /api/erc8004?action=submit-feedback
Content-Type: application/json

{
  "agentId": "42",
  "rating": 5,
  "comment": "Great agent!"
}
```

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ¥å£å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MCP Tools    â”‚  â”‚ HTTP API     â”‚  â”‚ WebSocket    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ERC8004      â”‚  â”‚ x402 Payment â”‚  â”‚ Event        â”‚   â”‚
â”‚  â”‚ Service      â”‚  â”‚ Service      â”‚  â”‚ Listener     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è®¿é—®å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ The Graph    â”‚  â”‚ Blockchain   â”‚  â”‚ Local DB     â”‚   â”‚
â”‚  â”‚ Client       â”‚  â”‚ (viem)       â”‚  â”‚ (Postgres)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

1. **æ³¨å†Œ Agent**
   - ç”¨æˆ· â†’ MCP Tool â†’ ERC8004Service â†’ é“¾ä¸Šåˆçº¦
   - é“¾ä¸Šåˆçº¦è§¦å‘ NewRegistration äº‹ä»¶
   - EventListener ç›‘å¬äº‹ä»¶ â†’ æ›´æ–°æœ¬åœ°æ•°æ®åº“
   - The Graph ç´¢å¼•äº‹ä»¶

2. **æœç´¢ Agent**
   - ç”¨æˆ· â†’ HTTP API â†’ ERC8004Service â†’ GraphClient
   - GraphClient æŸ¥è¯¢ Subgraph â†’ è¿”å›ç»“æœ
   - ï¼ˆå¯é€‰ï¼‰æœ¬åœ°æ•°æ®åº“ç¼“å­˜åŠ é€Ÿ

3. **æäº¤åé¦ˆ**
   - ç”¨æˆ· â†’ MCP Tool â†’ ERC8004Service â†’ é“¾ä¸Šåˆçº¦
   - é“¾ä¸Šåˆçº¦è§¦å‘ NewFeedback äº‹ä»¶
   - EventListener æ›´æ–° Agent å£°èª‰åˆ†æ•°

4. **é«˜çº§æŸ¥è¯¢ï¼ˆéœ€è¦æ”¯ä»˜ï¼‰**
   - ç”¨æˆ· â†’ HTTP API â†’ æ£€æŸ¥æ”¯ä»˜
   - x402 éªŒè¯æ”¯ä»˜ç­¾å
   - éªŒè¯é€šè¿‡ â†’ è¿”å›æ•°æ®

## å˜ç°è·¯å¾„

### æ–¹æ¡ˆä¸€ï¼šAgent å‘ç°å¹³å°ï¼ˆå…è´¹ + ä»˜è´¹ï¼‰

| åŠŸèƒ½ | å…è´¹ç‰ˆ | ä»˜è´¹ç‰ˆ |
|------|--------|--------|
| åŸºç¡€æœç´¢ | âœ… | âœ… |
| æŸ¥çœ‹ Agent è¯¦æƒ… | âœ… | âœ… |
| è·å–åé¦ˆï¼ˆâ‰¤10æ¡ï¼‰ | âœ… | âœ… |
| é«˜çº§ç­›é€‰ | âŒ | âœ… 0.0001 ETH/æ¬¡ |
| æ‰¹é‡æŸ¥è¯¢ | âŒ | âœ… 0.0005 ETH/æ¬¡ |
| API è®¿é—®é€Ÿç‡ | 10 req/min | 1000 req/min |
| å†å²æ•°æ®å¯¼å‡º | âŒ | âœ… 0.001 ETH/æ¬¡ |

### æ–¹æ¡ˆäºŒï¼šAgent æ³¨å†Œå³æœåŠ¡

- **æ³¨å†ŒæœåŠ¡è´¹**ï¼šæ¯ä¸ª Agent æ”¶å– 0.01 ETH
- **æœˆåº¦è®¢é˜…**ï¼šé«˜çº§ Agent å±•ç¤ºä½ 0.1 ETH/æœˆ
- **æ¨å¹¿æœåŠ¡**ï¼šç½®é¡¶å±•ç¤º 0.05 ETH/å‘¨

### æ–¹æ¡ˆä¸‰ï¼šå£°èª‰æ•°æ®åˆ†æ

- **å£°èª‰æŠ¥å‘Š**ï¼šä¸º Agent ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Š 0.005 ETH
- **å¯¹æ¯”åˆ†æ**ï¼šå¤šä¸ª Agent å¯¹æ¯”åˆ†æ 0.01 ETH
- **è¶‹åŠ¿é¢„æµ‹**ï¼šåŸºäºå†å²æ•°æ®çš„è¶‹åŠ¿é¢„æµ‹ 0.02 ETH

## åˆçº¦åœ°å€

### Sepolia æµ‹è¯•ç½‘

```
IdentityRegistry: 0x8004A818BFB912233c491871b3d84c89A494BD9e
ReputationRegistry: 0x8004B663056A597Dffe9eCcC1965A193B7388713
```

### ä¸»ç½‘ï¼ˆå¾…éƒ¨ç½²ï¼‰

å¾…è¡¥å……...

## å¼€å‘è·¯çº¿å›¾

### âœ… å·²å®Œæˆï¼ˆç¬¬ 1-2 å‘¨ï¼‰

- [x] ERC-8004 åˆçº¦é›†æˆ
- [x] The Graph å®¢æˆ·ç«¯
- [x] äº‹ä»¶ç›‘å¬å™¨
- [x] MCP å·¥å…·æ¥å£
- [x] HTTP API ç«¯ç‚¹
- [x] æ•°æ®åº“ Schema

### ğŸš§ è¿›è¡Œä¸­ï¼ˆç¬¬ 3-4 å‘¨ï¼‰

- [ ] x402 æ”¯ä»˜éªŒè¯å®Œæ•´é›†æˆ
- [ ] å‰ç«¯ UIï¼ˆAgent æœç´¢é¡µé¢ï¼‰
- [ ] è¯„åˆ†ç®—æ³•ä¼˜åŒ–
- [ ] ç¼“å­˜å±‚ä¼˜åŒ–

### ğŸ“‹ å¾…å¼€å‘ï¼ˆç¬¬ 5 å‘¨+ï¼‰

- [ ] WebSocket å®æ—¶é€šçŸ¥
- [ ] Agent è‡ªåŠ¨æ³¨å†Œè„šæœ¬
- [ ] åˆ†æä»ªè¡¨æ¿
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ç¤ºä¾‹ä»£ç 

### å®Œæ•´çš„ Agent æ³¨å†Œæµç¨‹

```typescript
import { ERC8004Service } from './src/erc8004/erc8004-service.js';

// åˆå§‹åŒ–æœåŠ¡
const service = new ERC8004Service(
  process.env.PRIVATE_KEY!,
  'sepolia',
  process.env.RPC_URL
);

// æ³¨å†Œ Agent
const { agentId, txHash } = await service.registerAgent(
  'My Trading Bot',
  {
    name: 'My Trading Bot',
    description: 'è‡ªåŠ¨åŒ–äº¤æ˜“æœºå™¨äºº',
    capabilities: ['trading', 'arbitrage'],
    apiEndpoint: 'https://api.mybot.com',
    pricing: {
      model: 'per-call',
      amount: '0.0001',
      currency: 'ETH'
    },
    tags: ['defi', 'trading']
  }
);

console.log(`Agent ID: ${agentId}`);
console.log(`TX: ${txHash}`);
```

### ç›‘å¬äº‹ä»¶å¹¶æ›´æ–°æ•°æ®åº“

```typescript
import { ERC8004EventListener } from './src/erc8004/event-listener.js';

const listener = new ERC8004EventListener('sepolia', RPC_URL);

// è®¾ç½®å¤„ç†å™¨
listener.setHandlers({
  onNewRegistration: async (event) => {
    console.log('æ–° Agent æ³¨å†Œ:', event.agentId);
    // æ›´æ–°æ•°æ®åº“
    await db.insertAgent(event);
  },
  onNewFeedback: async (event) => {
    console.log('æ–°åé¦ˆ:', event.feedbackId);
    // æ›´æ–°å£°èª‰åˆ†æ•°
    await db.updateReputation(event.agentId);
  }
});

// å¼€å§‹ç›‘å¬
await listener.startListening();
```

## èµ„æºé“¾æ¥

- [ERC-8004 å®˜æ–¹è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-8004)
- [ERC-8004 å®˜ç½‘](https://8004.org)
- [Awesome ERC-8004](https://github.com/sudeepb02/awesome-erc8004)
- [x402 å®˜ç½‘](https://www.x402.org)
- [The Graph æ–‡æ¡£](https://thegraph.com/docs)

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç¤ºä¾‹ä»£ç 
2. åœ¨ GitHub æäº¤ Issue
3. åŠ å…¥ç¤¾åŒºè®¨è®º

---

**ç”± Claude Code ç”Ÿæˆ** ğŸ¤–
åŸºäº ERC-8004 + x402 æ ‡å‡†æ„å»º
